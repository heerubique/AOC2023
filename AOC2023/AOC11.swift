//
//  Level11.swift
//  AdventOfCode
//
//  Created by Patrizia Heer on 11.12.2023.
//

import Foundation

class AOC11 {


    func run() {
        part1()
        part2()
    }

    func part1() {
        grid = Grid<String>(lines: input)
        print(grid)

        var duplicates = [Int]()
        for i in 0..<grid.rows.count {
            let row = grid.rows[i]
            if row.contains(where: { $0 == "#"}) == false {
                duplicates.append(i)
            }
        }

        var rows = grid.rows
        for indexes in duplicates.reversed() {
            for _ in 0..<1 {
                rows.insert(Array(repeating: ".", count: grid.columns.count), at: indexes)
            }
        }

        grid = Grid<String>(values: rows)

         duplicates = [Int]()
        for i in 0..<grid.columns.count {
            let column = grid.columns[i]
            if column.contains(where: { $0 == "#"}) == false {
                duplicates.append(i)
            }
        }

        var columns = grid.columns
        for indexes in duplicates.reversed() {
            for _ in 0..<1 {
                columns.insert(Array(repeating: ".", count: grid.rows.count), at: indexes)
            }
        }

        grid = Grid<String>(values: columns).transposed()

        print(grid)


        var indexes = [Vec2D<Int>]()
        for i in 0..<grid.rows.count {
            let row = grid.rows[i]

            row.enumerated().forEach {
                if $0.element == "#" {
                    indexes.append(Vec2D($0.offset, i))
                }
            }

        }

        var sum = 0
        for i in 0..<indexes.count-1 {
            let start = indexes[i]

            for z in i+1..<indexes.count {
                let end = indexes[z]

                print("\(i), \(z) | \(start) \(end)")
                let distance = abs(start.x-end.x) + abs(start.y-end.y)
                print(distance)
                sum += distance

            }

        }
        print(sum)
    }


    func part2() {
        grid = Grid<String>(lines: input)
        print(grid)

        var duplicateRows = [Int]()
        for i in 0..<grid.rows.count {
            let row = grid.rows[i]
            if row.contains(where: { $0 == "#"}) == false {
                duplicateRows.append(i)
            }
        }

        var duplicateColoumns = [Int]()
        for i in 0..<grid.columns.count {
            let column = grid.columns[i]
            if column.contains(where: { $0 == "#"}) == false {
                duplicateColoumns.append(i)
            }
        }


        var indexes = [Vec2D<Int>]()
        for i in 0..<grid.rows.count {
            let row = grid.rows[i]

            row.enumerated().forEach {
                if $0.element == "#" {
                    indexes.append(Vec2D($0.offset, i))
                }
            }

        }

        var sum = 0
        for i in 0..<indexes.count-1 {
            let start = indexes[i]

            for z in i+1..<indexes.count {
                let end = indexes[z]

                let rows = duplicateRows.filter { ($0 > start.y && $0 < end.y) || ($0 < start.y && $0 > end.y) }
                let cols = duplicateColoumns.filter { ($0 > start.x && $0 < end.x) || ($0 < start.x && $0 > end.x) }


                print("\(i), \(z) | \(start) \(end)")
                let distance = abs(start.x-end.x) + abs(start.y-end.y) + ((rows.count + cols.count) * 999999)
                print(distance)
                sum += distance

            }

        }
        print(sum)
    }

    var grid: Grid<String> = Grid(values: [])

    var input =
    """
..............................#.............#.....#.............#...........#......................................#...............#........
....................#.........................................................................#.........#...................................
...........#............................#...............................................#...................................................
......................................................................#...........................#.........................................
.#.......................................................#.....................................................#.............#..............
......................#.............#..............................................#.......#..........#.....................................
............................................................................................................................................
................#..........#................#................#................#........#..................................#.................
...................................................#........................................................#......................#........
............................................................................................................................................
.....#............................................................#.........................................................................
................................#.......................................#........#.............#........#.....................#.............
...........................................#.......................................................................#........................
..........#...........................................................................................................................#.....
.#.................................................#.....................................................................#..................
............................#......#.........................................#..............#................#..............................
..............#..........................................#........#...............................#.........................................
...................#.......................................................................................................................#
.........#..................................................................................................................................
..........................................................................................................#................#................
..#..........................................#.................................#.......#......#.......................#.....................
..................................................#.........................................................................................
.......#................#................................................#..................................................................
.............................#...........#...................#......................#............#...............................#.........#
.............#......................................................................................................#.......................
..............................................#................................................................#............................
.....................................#............................#..........#...........................#.................#................
.....................#......................................................................................................................
#.........................................#.......................................................#...............................#.........
......................................................................#.....................................................................
...................................#..................#........#....................#............................#..........................
...................#............................#...........................................................................................
...................................................................#....................#.....................................#........#....
.........#...............................#.....................................#.......................................#....................
.#..........................................................................................................................................
............................................................................................#......................#.......................#
................#..............#.............................#.......................#............#................................#........
.....................#............................#...............#.........................................................................
........................................................#.......................#.........................................#.................
...........................#..........................................#...............................#.....................................
.....................................#.....................................................................#................................
...........#.......#.............................................................................................................#.......#..
.....#........................#..................#..................................................................#.......................
...........................................#................................#...............................................................
..............................................................#.............................................................................
........................................................#............#...............#......................#...............................
.#..........................................................................................................................................
....................#...........#.......................................................................................#...................
......................................#..............#...........#.................................................#...................#....
.......#.....#..........#....................................................................#.................................#............
.............................#..............#...............................................................................................
............................................................................................................................................
#............................................................#.....................................#.....................................#..
....................#..................................#...........................#.....................#..................................
............................................................................................................................................
............#..........................................................#.............................................................#......
............................#...................................#.............#.................#.............#......#......#...............
..................#...........................#.............................................................................................
.......................#...........#.................................................#............................................#.........
............................................................................................................................................
..............................#.........#.................................#............................................................#....
............................................................................................................................................
....#.................................................................#...................................#..............#..................
...........#..................................................#...................................#.............#...........................
................#...........................#...............................................................................................
.#.....................#...............................#...........#...........#.....#.............................................#........
............................................................................................................................................
........#........................#.....................................#...............................................#....................
............................................................................................................................................
................................................................................................................#...........................
............................................................................................................................................
......................................#..............#.........#...........#...........#...............#....................................
...........#.......................................................................................................#.................#......
......#.....................................#.......................#......................#..............................................#.
..............................................................................#..............................................#..............
...............................#...........................#................................................#...............................
................................................#...................................................#............#...............#..........
............#............................#................................#.............#................................#..................
.................#.......#..................................................................................................................
....................................#.................................#..............................................#...............#......
.........#..................................................................................................................................
.............................#.................................................................................#............................
......................#...................#..................................................#.........#....................................
............................................................................................................................................
#..................................................#........................................................................................
........#.......................................................................#.................................#.......#.................
.............#.........................................#............#..............................................................#........
.....................................#........................#......................#............#.........................................
.........................#.......................#..........................#...........................#......................#............
.................................#.........#................................................................................................
...................#.........................................................................#..........................#...................
............................................................................................................................................
..............................#....................#............#.........................................................................#.
.........................................................................................................#.......#.........#................
..........#.......................................................................................................................#.........
....#.............#.......#.........................................#............#..........................................................
...................................#........................................................................................................
...........................................................#............................................................#...................
#..............................#.............#.....#.........................#.......#...............#........................#.....#.......
................................................................................................#........................................#..
........#...............#................................................................#...........................#......................
...................#.....................................#.......................#.........................................#................
............................................................................................................................................
..............#..................................................#...........................#...................#..........................
...............................#..............#...........................#.................................................................
#..........................................................#........................#..........................................#.......#....
.....................................................#....................................................#.........#.......................
..........................#................................................................#......#.......................#.................
....#.....#.....................................................................................................#...........................
.....................#.....................#..........................................#.....................................................
.........................................................................#..............................................................#...
..............#......................................................................................#........................#.............
...........................#..........#............#...............................................................#........................
........#....................................#..............................................................................................
.................................................................#..........................#....................................#..........
.................................................................................#.....................#.....#...........................#..
............................................................................................................................................
..........................#.................................................................................................................
..............................................................................#.............................................................
.........................................................................#...................#......................................#.......
...#.........#......#................................#..................................................................#...................
...............................#.............#...............#.......................#...........................#..........................
.......................................................................................................#.........................#..........
............................................................................#...............................................................
.#....................#.............................................#....................................................................#..
....................................#..................#....................................................................................
.....#........................#...............#..........................#...................................#..............................
...........#........................................................................................#.......................................
................#.........#................................#.....#..............................................................#...........
......................................#..............................................#.................................................#....
.................................................................................................#......#........#.....#....................
#......................#.............................................#......................................................................
..............#..........................#..............#...................................................................................
...........................................................................#................................................................
..................#..............#.................#..............#...........................................#.....................#.......
............................................................................................#...............................................
..........................#.............................................#........#........................#.................................
..........#...........................................#.....................................................................................
......................................#........................#...............................#...........................................#
.....#........#..............#.......................................#.............................................#..........#.............
"""

}

